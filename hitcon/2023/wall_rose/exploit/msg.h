#ifndef MOD_MSG_H
#define MOD_MSG_H

#include <stdint.h>
#include <sys/ipc.h>
#include <sys/msg.h>

#define MSG_COPY 040000
#define MTYPE_PRIMARY 0x41
#define MTYPE_SECONDARY 0x42
#define MTYPE_FAKE 0x43

typedef struct {
    long mtype;
    uint8_t mtext[0];
} msg_t;

struct list_head {
    uint64_t next, prev;
};

struct msg_msg {
    struct list_head m_list;
    long m_type;
    size_t m_ts; /* message text size */
    uint64_t next;
    uint64_t security;
    uint8_t text[0];
};

void send_secondary(size_t size, int qid, uint8_t init);

msg_t *msg_read(size_t size, int qid, int msgtyp, int msgflg);

void _msg_spray(size_t size, size_t count, int *qid, msg_t *msg, uint8_t init);

void msg_spray(size_t size, size_t count, int *qid);

void _msg_delete(size_t size, size_t count, int off, int *qid, msg_t *msg, long msgtyp, int msgflg);

void msg_delete(size_t size, size_t count, int off, int *qid);

#endif