#ifndef MOD_KEY_H
#define MOD_KEY_H

#include <linux/keyctl.h>
#include <stddef.h>

typedef int key_serial_t;

#define __aligned(x) __attribute__((__aligned__(x)))

struct callback_head {
	struct callback_head *next;
	void (*func)(struct callback_head *head);
} __attribute__((aligned(sizeof(void *))));
#define rcu_head callback_head

struct user_key_payload {
	struct rcu_head	rcu;								/* RCU destructor */
	unsigned short	datalen;							/* length of this data */
	char		data[] __aligned(__alignof__(long)); 	/* actual data */
};

key_serial_t add_key(const char *type, const char *description, void *payload, size_t plen, key_serial_t keyring);

void _keyspray(char *description, void *payload, size_t plen, size_t count, int *kid);

void key_spray(size_t plen, size_t count, int *kid);

#endif